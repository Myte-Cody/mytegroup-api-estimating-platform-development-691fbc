{
	"info": {
		"_postman_id": "test-infrastructure-plan",
		"name": "Test Infrastructure Plan - Project Assistant",
		"description": "Postman collection for sending the test infrastructure plan to the project assistant API",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Project Assistant Query",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer proj_92-lcvVNUs61dK_cT5UBS5KksgdxzG1tzN_MTokwkQ4",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"query\": \"Set up comprehensive test infrastructure for Spring Boot including service integration tests (with Testcontainers), controller tests (with mocked dependencies), and unit tests for mappers, utils, and services.\\n\\n## Overview\\n\\n**Service Integration Tests:**\\n- Uses Testcontainers with PostgreSQL for database testing\\n- Automatically cleans the database after each test using repository deleteAll() methods in @BeforeEach/@AfterEach\\n- Mocks external integrations (Email, SMS)\\n- Provides helper methods for test data setup via repositories\\n- Ensures Flyway migrations run in test environment\\n\\n**Controller Tests:**\\n- Tests controllers in isolation with mocked services and utilities\\n- Verifies HTTP requests and responses\\n- Uses MockMvc for web layer testing\\n\\n**Unit Tests:**\\n- Mapper unit tests: Test DTO to Entity mapping, update logic, null handling (14 mappers)\\n- Util unit tests: Test all static methods with various inputs, edge cases, null handling (3 utils)\\n- Service unit tests: Mock repositories and dependencies, test business logic in isolation\\n\\n## Implementation Plan\\n\\n### 1. Testcontainers Setup Class\\nCreate TestcontainersSetup.java:\\n- Reusable utility class for Testcontainers PostgreSQL container setup\\n- Manages container lifecycle (start/stop)\\n- Provides static methods to get container JDBC URL, username, password\\n- Uses @Container static field with @Testcontainers annotation\\n- Configures container reuse for faster test execution\\n- Sets system properties for Spring Boot to connect to the container\\n\\n### 2. Base Integration Test Class\\nCreate BaseIntegrationTest.java:\\n- Abstract base class for all service integration tests\\n- Uses TestcontainersSetup for database container management\\n- Configures Spring Boot test context with test profile\\n- Provides @BeforeEach and @AfterEach methods for database cleanup\\n- Uses repository deleteAll() methods to clean up database tables\\n- Cleans up in reverse dependency order to handle foreign key constraints\\n- Injects all repositories needed for cleanup via @Autowired\\n- Provides helper methods: setupOrganization(), setupUser(), setupCompany(), etc.\\n\\n### 3. Test Configuration for Mocking External Services\\nCreate TestMockConfig.java:\\n- Mock JavaMailSender bean for EmailService\\n- Mock SmsService bean (or create a test implementation)\\n- Use @MockBean or @TestConfiguration to replace external integrations\\n\\n### 4. Base Controller Test Class\\nCreate BaseControllerTest.java:\\n- Abstract base class for all controller tests\\n- Uses @WebMvcTest or @AutoConfigureMockMvc for web layer testing\\n- Provides MockMvc instance for making HTTP requests\\n- Mocks all services, utilities, and dependencies beneath the controller layer using @MockBean\\n- Provides helper methods for common test scenarios\\n- Does NOT use Testcontainers or real database (pure unit testing of controller layer)\\n\\n### 5. Mapper Unit Tests (14 tests)\\nCreate unit tests for all mapper classes:\\n- Test DTO to Entity mapping (toEntity methods)\\n- Test Entity update logic (updateEntity methods)\\n- Test null handling and edge cases\\n- Test partial updates (null fields in UpdateDto should not overwrite existing values)\\n- No mocking needed - mappers are simple transformation classes\\n\\nMappers to test:\\n- AuthMapper, CompanyMapper, CompanyLocationMapper, CostCodeMapper, EstimateMapper, GraphEdgeMapper, InviteMapper, LegalMapper, OfficeMapper, OrgTaxonomyMapper, OrganizationMapper, PersonMapper, ProjectMapper, UserMapper\\n\\n### 6. Util Unit Tests (3 tests)\\n\\n**PasswordValidatorTest:**\\n- Test isStrong() with various password patterns\\n- Test validateStrong() throws exception for weak passwords\\n- Test getStrength() returns correct scores and feedback\\n- Test edge cases (null, empty, too short, missing character classes)\\n- Test common patterns detection\\n\\n**DomainUtilTest:**\\n- Test normalizeDomainFromEmail() with valid/invalid emails\\n- Test normalizeEmail() with various formats\\n- Test isValidEmail() with valid/invalid patterns\\n- Test isPersonalEmailDomain() and isBusinessEmailDomain()\\n- Test isValidE164Phone() and normalizePhone()\\n- Test edge cases (null, empty, malformed)\\n\\n**TokenHashUtilTest:**\\n- Test generateToken() produces valid hex strings\\n- Test hashToken() produces consistent SHA-256 hashes\\n- Test verifyToken() correctly verifies tokens\\n- Test generateNumericCode() and generateVerificationCode()\\n- Test generateTokenWithHash() and generateTokenWithHashHours()\\n- Test edge cases (null, empty, invalid inputs)\\n\\n### 7. Service Unit Tests\\nCreate unit tests for service classes:\\n- Mock all repository dependencies using @MockBean or Mockito mocks\\n- Mock helper services (e.g., AuditLogService, ServiceAuthorizationHelper)\\n- Test business logic in isolation without database\\n- Test validation logic, authorization checks, exception handling\\n- Test edge cases and error scenarios\\n- Fast execution, no database required\\n- Complements integration tests: unit tests focus on logic, integration tests focus on database interactions\\n\\n### 8. Example Tests\\n- CompaniesServiceIntegrationTest.java (example service integration test)\\n- CompanyControllerTest.java (example controller test)\\n- CompaniesServiceTest.java (example service unit test)\\n\\n## Technical Details\\n\\n### Database Cleanup Approach\\n- Use repository deleteAll() methods\\n- Inject all repositories needed for cleanup via @Autowired\\n- Call deleteAll() on each repository in reverse dependency order\\n- Execute in both @BeforeEach (ensure clean state) and @AfterEach (clean up after test)\\n- This approach is type-safe, uses the same repository layer as the application, and handles entity relationships properly\\n\\n### Mocking Strategy\\n\\n**Service Integration Tests:**\\n- Use @MockBean for JavaMailSender to prevent actual email sending\\n- Use @MockBean for SmsService\\n- Use real repositories and database (via Testcontainers)\\n\\n**Controller Tests:**\\n- Use @MockBean for all service dependencies\\n- Use @MockBean for utility classes and helpers\\n- Use @MockBean for security-related beans\\n- Mock all layers beneath the controller to test controller in isolation\\n\\n**Service Unit Tests:**\\n- Use @MockBean or Mockito mocks for all repository dependencies\\n- Use @MockBean or Mockito mocks for helper services\\n- Mock external integrations (Email, SMS)\\n- Test business logic, validation, and exception handling in isolation\\n\\n**Mapper and Util Unit Tests:**\\n- No mocking needed - these are stateless transformation/utility classes\\n- Test with various inputs, edge cases, and null handling\\n\\n## Files to Create\\n\\nTest Infrastructure:\\n1. TestcontainersSetup.java\\n2. BaseIntegrationTest.java\\n3. BaseControllerTest.java\\n4. TestMockConfig.java\\n\\nExample Tests:\\n5. CompaniesServiceIntegrationTest.java\\n6. CompanyControllerTest.java\\n7. CompaniesServiceTest.java\\n\\nMapper Unit Tests (14):\\n8-21. All mapper test classes\\n\\nUtil Unit Tests (3):\\n22. PasswordValidatorTest.java\\n23. DomainUtilTest.java\\n24. TokenHashUtilTest.java\\n\\nConfiguration:\\n25. Update application-test.yml (ensure Flyway enabled)\\n26. Update ApplicationTests.java (refactor to use TestcontainersSetup if needed)\",\n  \"additional_context\": []\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://api.myte.dev/api/project-assistant/query",
					"protocol": "https",
					"host": [
						"api",
						"myte",
						"dev"
					],
					"path": [
						"api",
						"project-assistant",
						"query"
					]
				},
				"description": "Sends the test infrastructure plan to the project assistant API for implementation"
			},
			"response": []
		}
	]
}

