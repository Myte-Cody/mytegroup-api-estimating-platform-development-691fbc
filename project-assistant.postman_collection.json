{
  "info": {
    "name": "Project Assistant API",
    "description": "Collection for Project Assistant query endpoint",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Query - Spring Entity Migration Plan",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer proj_92-lcvVNUs61dK_cT5UBS5KksgdxzG1tzN_MTokwkQ4",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"# Spring Entity Migration Plan\\n\\n## Overview\\n\\nCreate Spring Boot JPA entities that mirror all 23 NestJS Mongoose schemas, organized by domain. Convert MongoDB string ID references to proper JPA relationships with `@ManyToOne`, `@OneToMany`, and `@OneToOne` annotations.\\n\\n## Domain Organization\\n\\n### 1. Core/Identity Domain\\n\\n- **User** - User accounts and authentication\\n- **Organization** - Tenant organizations\\n- **Invite** - User invitations\\n- **WaitlistEntry** - Waitlist management\\n\\n### 2. People Management Domain\\n\\n- **Person** - Modern person entity with emails/phones arrays\\n- **Contact** - Legacy contact entity\\n\\n### 3. Organizational Structure Domain\\n\\n- **Office** - Organization locations/offices\\n- **OrgTaxonomy** - Organization-specific taxonomy values\\n- **GraphEdge** - Generic graph relationships between entities\\n\\n### 4. Projects & Estimates Domain\\n\\n- **Project** - Construction projects\\n- **Estimate** - Project estimates\\n- **Seat** - Seat assignments for projects\\n\\n### 5. Companies & Locations Domain\\n\\n- **Company** - External companies\\n- **CompanyLocation** - Company locations\\n\\n### 6. Cost Management Domain\\n\\n- **CostCode** - Cost codes for projects\\n- **CostCodeImportJob** - Cost code import jobs\\n\\n### 7. Communication Domain\\n\\n- **EmailTemplate** - Email templates\\n- **ContactInquiry** - Contact form inquiries\\n- **Notification** - User notifications\\n\\n### 8. Legal & Compliance Domain\\n\\n- **LegalDoc** - Legal documents (terms, privacy)\\n- **LegalAcceptance** - User legal document acceptances\\n\\n### 9. System/Infrastructure Domain\\n\\n- **EventLog** - System event logging\\n- **TenantMigration** - Database migration tracking\\n- **Audit** - Already exists in Spring Boot\\n\\n## Entity Relationships\\n\\n### Key Relationships to Implement:\\n\\n1. **Organization** \\u2192 **User** (ownerUserId, createdByUserId)\\n2. **User** \\u2192 **Organization** (orgId)\\n3. **Person** \\u2192 **Organization** (orgId)\\n4. **Person** \\u2192 **Office** (orgLocationId)\\n5. **Person** \\u2192 **Person** (reportsToPersonId - self-reference)\\n6. **Person** \\u2192 **Company** (companyId)\\n7. **Person** \\u2192 **CompanyLocation** (companyLocationId)\\n8. **Person** \\u2192 **User** (userId)\\n9. **Project** \\u2192 **Organization** (orgId)\\n10. **Project** \\u2192 **Office** (officeId)\\n11. **Project** \\u2192 **Person** (staffing fields)\\n12. **Project** \\u2192 **CostCode** (costCodeBudgets)\\n13. **Project** \\u2192 **Seat** (seatAssignments)\\n14. **Estimate** \\u2192 **Project** (projectId)\\n15. **Estimate** \\u2192 **User** (createdByUserId)\\n16. **Seat** \\u2192 **User** (userId)\\n17. **Seat** \\u2192 **Project** (projectId)\\n18. **CompanyLocation** \\u2192 **Company** (companyId)\\n19. **CostCode** \\u2192 **CostCodeImportJob** (importJobId)\\n20. **Invite** \\u2192 **Organization** (orgId)\\n21. **Invite** \\u2192 **Person** (personId)\\n22. **Invite** \\u2192 **User** (createdByUserId, invitedUserId)\\n23. **GraphEdge** \\u2192 Various entities (polymorphic via nodeType/nodeId)\\n\\n## Implementation Details\\n\\n### Base Entity Structure\\n\\nAll entities will extend `BaseEntity` which provides:\\n\\n- `id` (Long, auto-generated)\\n- `createdAt` (LocalDateTime)\\n- `updatedAt` (LocalDateTime)\\n\\n### Common Fields Across Entities\\n\\n- `archivedAt` (LocalDateTime, nullable)\\n- `piiStripped` (Boolean, default false)\\n- `legalHold` (Boolean, default false)\\n- `orgId` (Long, foreign key to Organization)\\n\\n### Embedded Objects\\n\\nConvert Mongoose embedded schemas to JPA `@Embeddable` classes:\\n\\n- `PersonEmail` \\u2192 `@Embeddable` class\\n- `PersonPhone` \\u2192 `@Embeddable` class\\n- `PersonCertification` \\u2192 `@Embeddable` class\\n- `ProjectBudget` \\u2192 `@Embeddable` class\\n- `ProjectQuantities` \\u2192 `@Embeddable` class\\n- `ProjectStaffing` \\u2192 `@Embeddable` class\\n- `CostCodeBudget` \\u2192 `@Embeddable` class\\n- `SeatAssignment` \\u2192 `@Embeddable` class\\n- `OrgTaxonomyValue` \\u2192 `@Embeddable` class\\n- `EstimateLineItem` \\u2192 `@Embeddable` class\\n- `CollectionProgress` \\u2192 `@Embeddable` class\\n\\n### Collection Fields\\n\\nConvert Mongoose arrays to JPA collections:\\n\\n- Use `@ElementCollection` for simple arrays (String, Integer)\\n- Use `@OneToMany` with `@Embeddable` for complex embedded objects\\n- Use `@ManyToMany` for bidirectional relationships\\n\\n### Enum Types\\n\\nConvert TypeScript string enums and union types to Java enums, organized by domain. Create enum classes in domain-specific packages under `com.mytegroup.api.entity.enums`:\\n\\n#### 1. Core/Identity Domain Enums\\n\\n**Package**: `com.mytegroup.api.entity.enums.core`\\n\\n##### Role (common/roles.ts)\\n\\n**Package**: `com.mytegroup.api.common.enums` (shared across modules)\\n\\n**Used in**: User, Invite, and other entities\\n\\n**Values**:\\n\\n- `SUPER_ADMIN` (\\\"superadmin\\\")\\n- `PLATFORM_ADMIN` (\\\"platform_admin\\\")\\n- `ORG_OWNER` (\\\"org_owner\\\")\\n- `ORG_ADMIN` (\\\"org_admin\\\")\\n- `MANAGER` (\\\"manager\\\")\\n- `VIEWER` (\\\"viewer\\\")\\n- `ADMIN` (\\\"admin\\\")\\n- `COMPLIANCE_OFFICER` (\\\"compliance_officer\\\")\\n- `SECURITY_OFFICER` (\\\"security_officer\\\")\\n- `PM` (\\\"pm\\\")\\n- `ESTIMATOR` (\\\"estimator\\\")\\n- `ENGINEER` (\\\"engineer\\\")\\n- `DETAILER` (\\\"detailer\\\")\\n- `TRANSPORTER` (\\\"transporter\\\")\\n- `FOREMAN` (\\\"foreman\\\")\\n- `SUPERINTENDENT` (\\\"superintendent\\\")\\n- `QAQC` (\\\"qaqc\\\")\\n- `HS` (\\\"hs\\\")\\n- `PURCHASING` (\\\"purchasing\\\")\\n- `COMPLIANCE` (\\\"compliance\\\")\\n- `SECURITY` (\\\"security\\\")\\n- `FINANCE` (\\\"finance\\\")\\n- `USER` (\\\"user\\\")\\n\\n##### InviteStatus (invites/schemas/invite.schema.ts)\\n\\n**Used in**: Invite entity\\n\\n**Values**:\\n\\n- `PENDING` (\\\"pending\\\")\\n- `ACCEPTED` (\\\"accepted\\\")\\n- `EXPIRED` (\\\"expired\\\")\\n\\n**Default**: `PENDING`\\n\\n##### WaitlistStatus (waitlist/waitlist.schema.ts)\\n\\n**Used in**: WaitlistEntry entity\\n\\n**Values**:\\n\\n- `PENDING_COHORT` (\\\"pending-cohort\\\")\\n- `INVITED` (\\\"invited\\\")\\n- `ACTIVATED` (\\\"activated\\\")\\n\\n**Default**: `PENDING_COHORT`\\n\\n##### WaitlistVerifyStatus (waitlist/waitlist.schema.ts)\\n\\n**Used in**: WaitlistEntry entity (verifyStatus, phoneVerifyStatus fields)\\n\\n**Values**:\\n\\n- `UNVERIFIED` (\\\"unverified\\\")\\n- `VERIFIED` (\\\"verified\\\")\\n- `BLOCKED` (\\\"blocked\\\")\\n\\n**Default**: `UNVERIFIED`\\n\\n#### 2. People Management Domain Enums\\n\\n**Package**: `com.mytegroup.api.entity.enums.people`\\n\\n##### PersonType (persons/schemas/person.schema.ts)\\n\\n**Used in**: Person entity\\n\\n**Values**:\\n\\n- `INTERNAL_STAFF` (\\\"internal_staff\\\")\\n- `INTERNAL_UNION` (\\\"internal_union\\\")\\n- `EXTERNAL_PERSON` (\\\"external_person\\\")\\n\\n##### ContactPersonType (contacts/schemas/contact.schema.ts)\\n\\n**Note**: Different from PersonType - separate enum\\n\\n**Used in**: Contact entity\\n\\n**Values**:\\n\\n- `STAFF` (\\\"staff\\\")\\n- `IRONWORKER` (\\\"ironworker\\\")\\n- `EXTERNAL` (\\\"external\\\")\\n\\n**Default**: `EXTERNAL`\\n\\n##### ContactKind (contacts/schemas/contact.schema.ts)\\n\\n**Used in**: Contact entity\\n\\n**Values**:\\n\\n- `INDIVIDUAL` (\\\"individual\\\")\\n- `BUSINESS` (\\\"business\\\")\\n\\n**Default**: `INDIVIDUAL`\\n\\n#### 3. Organizational Structure Domain Enums\\n\\n**Package**: `com.mytegroup.api.entity.enums.organization`\\n\\n##### GraphNodeType (graph-edges/schemas/graph-edge.schema.ts)\\n\\n**Used in**: GraphEdge entity (fromNodeType, toNodeType fields)\\n\\n**Values**:\\n\\n- `PERSON` (\\\"person\\\")\\n- `ORG_LOCATION` (\\\"org_location\\\")\\n- `COMPANY` (\\\"company\\\")\\n- `COMPANY_LOCATION` (\\\"company_location\\\")\\n\\n##### DatastoreType (organizations/schemas/organization.schema.ts)\\n\\n**Used in**: Organization entity\\n\\n**Values**:\\n\\n- `SHARED` (\\\"shared\\\")\\n- `DEDICATED` (\\\"dedicated\\\")\\n\\n**Default**: `SHARED`\\n\\n##### DataResidency (organizations/schemas/organization.schema.ts)\\n\\n**Used in**: Organization entity\\n\\n**Values**:\\n\\n- `SHARED` (\\\"shared\\\")\\n- `DEDICATED` (\\\"dedicated\\\")\\n\\n**Default**: `SHARED`\\n\\n#### 4. Projects & Estimates Domain Enums\\n\\n**Package**: `com.mytegroup.api.entity.enums.projects`\\n\\n##### EstimateStatus (estimates/schemas/estimate.schema.ts)\\n\\n**Used in**: Estimate entity\\n\\n**Values**:\\n\\n- `DRAFT` (\\\"draft\\\")\\n- `FINAL` (\\\"final\\\")\\n- `ARCHIVED` (\\\"archived\\\")\\n\\n**Default**: `DRAFT`\\n\\n##### SeatStatus (seats/schemas/seat.schema.ts)\\n\\n**Used in**: Seat entity\\n\\n**Values**:\\n\\n- `VACANT` (\\\"vacant\\\")\\n- `ACTIVE` (\\\"active\\\")\\n\\n**Default**: `VACANT`\\n\\n#### 5. Cost Management Domain Enums\\n\\n**Package**: `com.mytegroup.api.entity.enums.cost`\\n\\n##### CostCodeImportStatus (cost-codes/schemas/cost-code-import-job.schema.ts)\\n\\n**Used in**: CostCodeImportJob entity\\n\\n**Values**:\\n\\n- `QUEUED` (\\\"queued\\\")\\n- `PROCESSING` (\\\"processing\\\")\\n- `PREVIEW` (\\\"preview\\\")\\n- `DONE` (\\\"done\\\")\\n- `FAILED` (\\\"failed\\\")\\n\\n**Default**: `QUEUED`\\n\\n#### 6. Communication Domain Enums\\n\\n**Package**: `com.mytegroup.api.entity.enums.communication`\\n\\n##### ContactInquiryStatus (contact-inquiries/schemas/contact-inquiry.schema.ts)\\n\\n**Used in**: ContactInquiry entity\\n\\n**Values**:\\n\\n- `NEW` (\\\"new\\\")\\n- `IN_PROGRESS` (\\\"in-progress\\\")\\n- `CLOSED` (\\\"closed\\\")\\n\\n**Default**: `NEW`\\n\\n#### 7. Legal & Compliance Domain Enums\\n\\n**Package**: `com.mytegroup.api.entity.enums.legal`\\n\\n##### LegalDocType (legal/legal.types.ts)\\n\\n**Used in**: LegalDoc, LegalAcceptance entities\\n\\n**Values**:\\n\\n- `PRIVACY_POLICY` (\\\"privacy_policy\\\")\\n- `TERMS` (\\\"terms\\\")\\n\\n#### 8. System/Infrastructure Domain Enums\\n\\n**Package**: `com.mytegroup.api.entity.enums.system`\\n\\n##### MigrationDirection (migrations/schemas/tenant-migration.schema.ts)\\n\\n**Used in**: TenantMigration entity\\n\\n**Values**:\\n\\n- `SHARED_TO_DEDICATED` (\\\"shared_to_dedicated\\\")\\n- `DEDICATED_TO_SHARED` (\\\"dedicated_to_shared\\\")\\n\\n##### MigrationStatus (migrations/schemas/tenant-migration.schema.ts)\\n\\n**Used in**: TenantMigration entity\\n\\n**Values**:\\n\\n- `PENDING` (\\\"pending\\\")\\n- `IN_PROGRESS` (\\\"in_progress\\\")\\n- `READY_FOR_CUTOVER` (\\\"ready_for_cutover\\\")\\n- `COMPLETED` (\\\"completed\\\")\\n- `FAILED` (\\\"failed\\\")\\n- `ABORTED` (\\\"aborted\\\")\\n\\n**Default**: `PENDING`\\n\\n### Enum Implementation Notes\\n\\n- Use `@Enumerated(EnumType.STRING)` for all enum fields to store string values in database\\n- Use `@Column(nullable = false)` for required enum fields\\n- Provide default values in entity constructors or use `@ColumnDefault` annotation\\n- Create `Role` enum in `common.enums` package since it's shared across multiple domains\\n- Organize enums by domain in sub-packages: `core`, `people`, `organization`, `projects`, `cost`, `communication`, `legal`, `system`\\n- Note: `PersonType` exists in two forms - one for Person entity and one for Contact entity (named `ContactPersonType` in Java)\\n\\n## File Structure\\n\\n```\\nspring-boot-api/src/main/java/com/mytegroup/api/\\n\\u251c\\u2500\\u2500 common/\\n\\u2502   \\u2514\\u2500\\u2500 enums/\\n\\u2502       \\u2514\\u2500\\u2500 Role.java\\n\\u251c\\u2500\\u2500 entity/\\n\\u2502   \\u251c\\u2500\\u2500 BaseEntity.java (exists)\\n\\u2502   \\u251c\\u2500\\u2500 Audit.java (exists)\\n\\u2502   \\u251c\\u2500\\u2500 enums/\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 core/\\n\\u2502   \\u2502   \\u2502   \\u251c\\u2500\\u2500 InviteStatus.java\\n\\u2502   \\u2502   \\u2502   \\u251c\\u2500\\u2500 WaitlistStatus.java\\n\\u2502   \\u2502   \\u2502   \\u2514\\u2500\\u2500 WaitlistVerifyStatus.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 people/\\n\\u2502   \\u2502   \\u2502   \\u251c\\u2500\\u2500 PersonType.java\\n\\u2502   \\u2502   \\u2502   \\u251c\\u2500\\u2500 ContactPersonType.java\\n\\u2502   \\u2502   \\u2502   \\u2514\\u2500\\u2500 ContactKind.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 organization/\\n\\u2502   \\u2502   \\u2502   \\u251c\\u2500\\u2500 GraphNodeType.java\\n\\u2502   \\u2502   \\u2502   \\u251c\\u2500\\u2500 DatastoreType.java\\n\\u2502   \\u2502   \\u2502   \\u2514\\u2500\\u2500 DataResidency.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 projects/\\n\\u2502   \\u2502   \\u2502   \\u251c\\u2500\\u2500 EstimateStatus.java\\n\\u2502   \\u2502   \\u2502   \\u2514\\u2500\\u2500 SeatStatus.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 cost/\\n\\u2502   \\u2502   \\u2502   \\u2514\\u2500\\u2500 CostCodeImportStatus.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 communication/\\n\\u2502   \\u2502   \\u2502   \\u2514\\u2500\\u2500 ContactInquiryStatus.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 legal/\\n\\u2502   \\u2502   \\u2502   \\u2514\\u2500\\u2500 LegalDocType.java\\n\\u2502   \\u2502   \\u2514\\u2500\\u2500 system/\\n\\u2502   \\u2502       \\u251c\\u2500\\u2500 MigrationDirection.java\\n\\u2502   \\u2502       \\u2514\\u2500\\u2500 MigrationStatus.java\\n\\u2502   \\u251c\\u2500\\u2500 core/\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 User.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 Organization.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 Invite.java\\n\\u2502   \\u2502   \\u2514\\u2500\\u2500 WaitlistEntry.java\\n\\u2502   \\u251c\\u2500\\u2500 people/\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 Person.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 Contact.java\\n\\u2502   \\u2502   \\u2514\\u2500\\u2500 embeddable/\\n\\u2502   \\u2502       \\u251c\\u2500\\u2500 PersonEmail.java\\n\\u2502   \\u2502       \\u251c\\u2500\\u2500 PersonPhone.java\\n\\u2502   \\u2502       \\u2514\\u2500\\u2500 PersonCertification.java\\n\\u2502   \\u251c\\u2500\\u2500 organization/\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 Office.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 OrgTaxonomy.java\\n\\u2502   \\u2502   \\u2514\\u2500\\u2500 GraphEdge.java\\n\\u2502   \\u251c\\u2500\\u2500 projects/\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 Project.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 Estimate.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 Seat.java\\n\\u2502   \\u2502   \\u2514\\u2500\\u2500 embeddable/\\n\\u2502   \\u2502       \\u251c\\u2500\\u2500 ProjectBudget.java\\n\\u2502   \\u2502       \\u251c\\u2500\\u2500 ProjectQuantities.java\\n\\u2502   \\u2502       \\u251c\\u2500\\u2500 ProjectStaffing.java\\n\\u2502   \\u2502       \\u251c\\u2500\\u2500 CostCodeBudget.java\\n\\u2502   \\u2502       \\u251c\\u2500\\u2500 SeatAssignment.java\\n\\u2502   \\u2502       \\u2514\\u2500\\u2500 EstimateLineItem.java\\n\\u2502   \\u251c\\u2500\\u2500 companies/\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 Company.java\\n\\u2502   \\u2502   \\u2514\\u2500\\u2500 CompanyLocation.java\\n\\u2502   \\u251c\\u2500\\u2500 cost/\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 CostCode.java\\n\\u2502   \\u2502   \\u2514\\u2500\\u2500 CostCodeImportJob.java\\n\\u2502   \\u251c\\u2500\\u2500 communication/\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 EmailTemplate.java\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 ContactInquiry.java\\n\\u2502   \\u2502   \\u2514\\u2500\\u2500 Notification.java\\n\\u2502   \\u251c\\u2500\\u2500 legal/\\n\\u2502   \\u2502   \\u251c\\u2500\\u2500 LegalDoc.java\\n\\u2502   \\u2502   \\u2514\\u2500\\u2500 LegalAcceptance.java\\n\\u2502   \\u2514\\u2500\\u2500 system/\\n\\u2502       \\u251c\\u2500\\u2500 EventLog.java\\n\\u2502       \\u2514\\u2500\\u2500 TenantMigration.java\\n```\\n\\n## Mandatory Fields by Entity\\n\\n### Core/Identity Domain\\n\\n#### User\\n\\n- `username` (String, unique, @Column(nullable = false))\\n- `email` (String, unique, @Column(nullable = false))\\n- `passwordHash` (String, @Column(nullable = false))\\n- `role` (String, default: 'user', @Column(nullable = false))\\n- `roles` (List<String>, default: ['user'], @ElementCollection)\\n- `isEmailVerified` (Boolean, default: false, @Column(nullable = false))\\n- `isOrgOwner` (Boolean, default: false, @Column(nullable = false))\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n#### Organization\\n\\n- `name` (String, unique, @Column(nullable = false))\\n- `useDedicatedDb` (Boolean, default: false, @Column(nullable = false))\\n- `datastoreType` (enum, default: 'shared', @Column(nullable = false))\\n- `dataResidency` (enum, default: 'shared', @Column(nullable = false))\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n#### Invite\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `email` (String, @Column(nullable = false))\\n- `role` (String, @Column(nullable = false))\\n- `tokenHash` (String, @Column(nullable = false))\\n- `tokenExpires` (LocalDateTime, @Column(nullable = false))\\n- `status` (enum, default: 'pending', @Column(nullable = false))\\n- `createdByUserId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n#### WaitlistEntry\\n\\n- `email` (String, unique, @Column(nullable = false))\\n- `name` (String, @Column(nullable = false))\\n- `phone` (String, @Column(nullable = false))\\n- `role` (String, @Column(nullable = false))\\n- `status` (enum, default: 'pending-cohort', @Column(nullable = false))\\n- `verifyStatus` (enum, default: 'unverified', @Column(nullable = false))\\n- `verifyAttempts` (Integer, default: 0, @Column(nullable = false))\\n- `verifyAttemptTotal` (Integer, default: 0, @Column(nullable = false))\\n- `verifyResends` (Integer, default: 0, @Column(nullable = false))\\n- `phoneVerifyStatus` (enum, default: 'unverified', @Column(nullable = false))\\n- `phoneVerifyAttempts` (Integer, default: 0, @Column(nullable = false))\\n- `phoneVerifyAttemptTotal` (Integer, default: 0, @Column(nullable = false))\\n- `phoneVerifyResends` (Integer, default: 0, @Column(nullable = false))\\n- `preCreateAccount` (Boolean, default: false, @Column(nullable = false))\\n- `marketingConsent` (Boolean, default: false, @Column(nullable = false))\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n### People Management Domain\\n\\n#### Person\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `personType` (enum, @Column(nullable = false))\\n- `displayName` (String, @Column(nullable = false))\\n- `emails` (List<PersonEmail>, default: [], @ElementCollection)\\n- `phones` (List<PersonPhone>, default: [], @ElementCollection)\\n- `tagKeys` (List<String>, default: [], @ElementCollection)\\n- `skillKeys` (List<String>, default: [], @ElementCollection)\\n- `skillFreeText` (List<String>, default: [], @ElementCollection)\\n- `certifications` (List<PersonCertification>, default: [], @ElementCollection)\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n**PersonEmail (@Embeddable):**\\n\\n- `value` (String, @Column(nullable = false))\\n- `normalized` (String, @Column(nullable = false))\\n\\n**PersonPhone (@Embeddable):**\\n\\n- `value` (String, @Column(nullable = false))\\n- `e164` (String, @Column(nullable = false))\\n\\n**PersonCertification (@Embeddable):**\\n\\n- `name` (String, @Column(nullable = false))\\n\\n#### Contact\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `name` (String, @Column(nullable = false))\\n- `personType` (enum, default: 'external', @Column(nullable = false))\\n- `contactKind` (enum, default: 'individual', @Column(nullable = false))\\n- `promotedToForeman` (Boolean, default: false, @Column(nullable = false))\\n- `roles` (List<String>, default: [], @ElementCollection)\\n- `tags` (List<String>, default: [], @ElementCollection)\\n- `skills` (List<String>, default: [], @ElementCollection)\\n- `certifications` (List<ContactCertification>, default: [], @ElementCollection)\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n**ContactCertification (@Embeddable):**\\n\\n- `name` (String, @Column(nullable = false))\\n\\n### Organizational Structure Domain\\n\\n#### Office\\n\\n- `name` (String, @Column(nullable = false))\\n- `normalizedName` (String, @Column(nullable = false))\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `tagKeys` (List<String>, default: [], @ElementCollection)\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n#### OrgTaxonomy\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `namespace` (String, @Column(nullable = false))\\n- `values` (List<OrgTaxonomyValue>, default: [], @ElementCollection)\\n\\n**OrgTaxonomyValue (@Embeddable):**\\n\\n- `key` (String, @Column(nullable = false))\\n- `label` (String, @Column(nullable = false))\\n\\n#### GraphEdge\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `fromNodeType` (enum, @Column(nullable = false))\\n- `fromNodeId` (Long, @Column(nullable = false))\\n- `toNodeType` (enum, @Column(nullable = false))\\n- `toNodeId` (Long, @Column(nullable = false))\\n- `edgeTypeKey` (String, @Column(nullable = false))\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n### Projects & Estimates Domain\\n\\n#### Project\\n\\n- `name` (String, @Column(nullable = false))\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `costCodeBudgets` (List<CostCodeBudget>, default: [], @ElementCollection)\\n- `seatAssignments` (List<SeatAssignment>, default: [], @ElementCollection)\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n**CostCodeBudget (@Embeddable):**\\n\\n- `costCodeId` (Long, @Column(nullable = false))\\n\\n**SeatAssignment (@Embeddable):**\\n\\n- `seatId` (Long, @Column(nullable = false))\\n\\n#### Estimate\\n\\n- `projectId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `createdByUserId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `name` (String, @Column(nullable = false))\\n- `status` (enum, default: 'draft', @Column(nullable = false))\\n- `revision` (Integer, default: 1, @Column(nullable = false))\\n- `lineItems` (List<EstimateLineItem>, default: [], @ElementCollection)\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n#### Seat\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `seatNumber` (Integer, @Column(nullable = false))\\n- `status` (enum, default: 'vacant', @Column(nullable = false))\\n- `history` (List<SeatHistoryEntry>, default: [], @ElementCollection)\\n\\n### Companies & Locations Domain\\n\\n#### Company\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `name` (String, @Column(nullable = false))\\n- `normalizedName` (String, @Column(nullable = false))\\n- `companyTypeKeys` (List<String>, default: [], @ElementCollection)\\n- `tagKeys` (List<String>, default: [], @ElementCollection)\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n#### CompanyLocation\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `companyId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `name` (String, @Column(nullable = false))\\n- `normalizedName` (String, @Column(nullable = false))\\n- `tagKeys` (List<String>, default: [], @ElementCollection)\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n### Cost Management Domain\\n\\n#### CostCode\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `category` (String, @Column(nullable = false))\\n- `code` (String, @Column(nullable = false))\\n- `description` (String, @Column(nullable = false))\\n- `active` (Boolean, default: false, @Column(nullable = false))\\n- `isUsed` (Boolean, default: false, @Column(nullable = false))\\n\\n#### CostCodeImportJob\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `status` (enum, default: 'queued', @Column(nullable = false))\\n- `preview` (List<CostCodeImportPreview>, default: [], @ElementCollection)\\n- `dryRun` (Boolean, default: false, @Column(nullable = false))\\n- `resumeRequested` (Boolean, default: true, @Column(nullable = false))\\n- `allowLegalHoldOverride` (Boolean, default: false, @Column(nullable = false))\\n- `chunkSize` (Integer, default: 100, @Column(nullable = false))\\n- `progress` (Map<String, CollectionProgress>, default: {}, @ElementCollection)\\n- `startedAt` (LocalDateTime, default: now, @Column(nullable = false))\\n\\n### Communication Domain\\n\\n#### EmailTemplate\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `name` (String, @Column(nullable = false))\\n- `locale` (String, default: EMAIL_TEMPLATE_DEFAULT_LOCALE, @Column(nullable = false))\\n- `subject` (String, @Column(nullable = false))\\n- `html` (String, @Column(nullable = false))\\n- `text` (String, @Column(nullable = false))\\n- `requiredVariables` (List<String>, default: [], @ElementCollection)\\n- `optionalVariables` (List<String>, default: [], @ElementCollection)\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n#### ContactInquiry\\n\\n- `name` (String, @Column(nullable = false))\\n- `email` (String, @Column(nullable = false))\\n- `message` (String, @Column(nullable = false))\\n- `status` (enum, default: 'new', @Column(nullable = false))\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n#### Notification\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `userId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `type` (String, @Column(nullable = false))\\n- `payload` (Map<String, Object>, default: {}, @ElementCollection)\\n- `read` (Boolean, default: false, @Column(nullable = false))\\n\\n### Legal & Compliance Domain\\n\\n#### LegalDoc\\n\\n- `type` (enum, @Column(nullable = false))\\n- `version` (String, @Column(nullable = false))\\n- `content` (String, @Column(nullable = false))\\n- `effectiveAt` (LocalDateTime, default: now, @Column(nullable = false))\\n\\n#### LegalAcceptance\\n\\n- `userId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `docType` (enum, @Column(nullable = false))\\n- `version` (String, @Column(nullable = false))\\n- `acceptedAt` (LocalDateTime, default: now, @Column(nullable = false))\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n\\n### System/Infrastructure Domain\\n\\n#### EventLog\\n\\n- `eventType` (String, @Column(nullable = false))\\n- `piiStripped` (Boolean, default: false, @Column(nullable = false))\\n- `legalHold` (Boolean, default: false, @Column(nullable = false))\\n- `createdAt` (LocalDateTime, auto-generated, @Column(nullable = false))\\n\\n#### TenantMigration\\n\\n- `orgId` (Long, @ManyToOne, @JoinColumn(nullable = false))\\n- `direction` (enum, @Column(nullable = false))\\n- `status` (enum, default: 'pending', @Column(nullable = false))\\n- `dryRun` (Boolean, default: false, @Column(nullable = false))\\n- `resumeRequested` (Boolean, default: true, @Column(nullable = false))\\n- `allowLegalHoldOverride` (Boolean, default: false, @Column(nullable = false))\\n- `chunkSize` (Integer, default: 100, @Column(nullable = false))\\n- `progress` (Map<String, CollectionProgress>, default: {}, @ElementCollection)\\n- `startedAt` (LocalDateTime, default: now, @Column(nullable = false))\\n\\n## Self-Referencing Relationships\\n\\n1. **Person** \\u2192 **Person** (`reportsToPersonId`)\\n\\n   - `@ManyToOne @JoinColumn(name = \\\"reports_to_person_id\\\") private Person reportsTo;`\\n   - `@OneToMany(mappedBy = \\\"reportsTo\\\") private List<Person> reports;`\\n   - Validation: Cannot reference self\\n\\n2. **Contact** \\u2192 **Contact** (`reportsToContactId`)\\n\\n   - `@ManyToOne @JoinColumn(name = \\\"reports_to_contact_id\\\") private Contact reportsTo;`\\n   - `@OneToMany(mappedBy = \\\"reportsTo\\\") private List<Contact> reports;`\\n\\n3. **Office** \\u2192 **Office** (`parentOrgLocationId`)\\n\\n   - `@ManyToOne @JoinColumn(name = \\\"parent_org_location_id\\\") private Office parent;`\\n   - `@OneToMany(mappedBy = \\\"parent\\\") private List<Office> children;`\\n   - Validation: Cannot reference self\\n\\n## Indexes\\n\\nReplicate all Mongoose indexes as JPA `@Table` indexes:\\n\\n- Unique constraints for business keys\\n- Composite indexes for common queries\\n- Partial indexes will be handled via application logic (archivedAt filtering)\\n\\n## Flyway Migration Scripts\\n\\nCreate Flyway migration scripts to create all database tables, organized by domain. Migration files should be placed in `spring-boot-api/src/main/resources/db/migration/` following the naming convention `V{version}__{description}.sql`.\\n\\n### Migration Script Organization\\n\\n#### V2__Create_Core_Domain_Tables.sql\\n\\n**Tables**: `organizations`, `users`, `invites`, `waitlist_entries`\\n\\n**Order**: Create `organizations` first (no dependencies), then `users` (depends on organizations), then `invites` and `waitlist_entries` (depend on organizations/users).\\n\\n**Key Features**:\\n\\n- `organizations`: Unique constraint on `name`, unique partial index on `primary_domain` (where not null)\\n- `users`: Unique constraint on `email`, composite index on `org_id, archived_at`\\n- `invites`: Composite indexes on `org_id, email, status` and `org_id, person_id, status`, index on `token_hash`, TTL index on `token_expires`\\n- `waitlist_entries`: Unique constraint on `email`, indexes on `status, created_at` and `verify_status, status, created_at`\\n\\n#### V3__Create_People_Domain_Tables.sql\\n\\n**Tables**: `persons`, `contacts`\\n\\n**Order**: Create `persons` and `contacts` (both depend on organizations).\\n\\n**Key Features**:\\n\\n- `persons`: \\n  - Unique partial indexes on `org_id, primary_email` (where archived_at is null and primary_email is not null)\\n  - Unique partial indexes on `org_id, external_id`, `org_id, primary_phone_e164`, `org_id, ironworker_number`\\n  - Composite indexes on `org_id, archived_at`, `org_id, emails_normalized`, `org_id, phones_e164`\\n  - Self-referencing FK: `reports_to_person_id` \\u2192 `persons(id)`\\n  - Embedded collections: `person_emails`, `person_phones`, `person_certifications` (element collections)\\n- `contacts`:\\n  - Composite indexes on `org_id, email`, `org_id, person_type, archived_at`, `org_id, ironworker_number`, `org_id, archived_at`\\n  - Self-referencing FK: `reports_to_contact_id` \\u2192 `contacts(id)`\\n  - Embedded collections: `contact_certifications` (element collection)\\n\\n#### V4__Create_Organization_Domain_Tables.sql\\n\\n**Tables**: `offices`, `org_taxonomies`, `graph_edges`\\n\\n**Order**: Create `offices` first (depends on organizations, self-referencing), then `org_taxonomies` and `graph_edges` (depend on organizations).\\n\\n**Key Features**:\\n\\n- `offices`:\\n  - Unique partial index on `org_id, normalized_name` (where archived_at is null)\\n  - Composite indexes on `org_id, archived_at`, `org_id, parent_org_location_id`\\n  - Self-referencing FK: `parent_org_location_id` \\u2192 `offices(id)`\\n  - Embedded collection: `office_tag_keys` (element collection)\\n- `org_taxonomies`:\\n  - Unique constraint on `org_id, namespace`\\n  - Embedded collection: `org_taxonomy_values` (JSONB or separate table for complex structure)\\n- `graph_edges`:\\n  - Unique partial index on `org_id, edge_type_key, from_node_type, from_node_id, to_node_type, to_node_id` (where archived_at is null)\\n  - Composite indexes on `org_id, from_node_type, from_node_id`, `org_id, to_node_type, to_node_id`, `org_id, archived_at`\\n\\n#### V5__Create_Projects_Domain_Tables.sql\\n\\n**Tables**: `projects`, `estimates`, `seats`\\n\\n**Order**: Create `projects` first (depends on organizations, offices), then `estimates` (depends on projects), then `seats` (depends on organizations, projects, users).\\n\\n**Key Features**:\\n\\n- `projects`:\\n  - Unique partial indexes on `org_id, name` and `org_id, project_code` (where archived_at is null)\\n  - Composite index on `org_id, archived_at`\\n  - Embedded collections: `project_cost_code_budgets`, `project_seat_assignments` (element collections)\\n  - Embedded objects: `project_budget` (JSONB), `project_quantities` (JSONB), `project_staffing` (JSONB)\\n- `estimates`:\\n  - Unique partial index on `org_id, project_id, name` (where archived_at is null)\\n  - Composite index on `org_id, project_id, archived_at`\\n  - Embedded collection: `estimate_line_items` (element collection)\\n- `seats`:\\n  - Unique constraint on `org_id, seat_number`\\n  - Unique partial index on `org_id, user_id` (where user_id is not null)\\n  - Composite indexes on `org_id, status`, `org_id, role, status`, `org_id, project_id`\\n  - Embedded collection: `seat_history` (element collection)\\n\\n#### V6__Create_Companies_Domain_Tables.sql\\n\\n**Tables**: `companies`, `company_locations`\\n\\n**Order**: Create `companies` first (depends on organizations), then `company_locations` (depends on companies).\\n\\n**Key Features**:\\n\\n- `companies`:\\n  - Unique partial index on `org_id, normalized_name` (where archived_at is null)\\n  - Unique partial index on `org_id, external_id` (where archived_at is null and external_id is not null)\\n  - Composite indexes on `org_id, archived_at`, `org_id, company_type_keys`, `org_id, tag_keys`\\n  - Embedded collections: `company_type_keys`, `company_tag_keys` (element collections)\\n- `company_locations`:\\n  - Unique partial index on `org_id, company_id, normalized_name` (where archived_at is null)\\n  - Unique partial index on `org_id, company_id, external_id` (where archived_at is null and external_id is not null)\\n  - Composite indexes on `org_id, company_id`, `org_id, tag_keys`, `org_id, company_id, tag_keys`, `org_id, archived_at`\\n  - Embedded collection: `company_location_tag_keys` (element collection)\\n\\n#### V7__Create_Cost_Domain_Tables.sql\\n\\n**Tables**: `cost_codes`, `cost_code_import_jobs`\\n\\n**Order**: Create `cost_code_import_jobs` first (depends on organizations), then `cost_codes` (depends on organizations and import jobs).\\n\\n**Key Features**:\\n\\n- `cost_codes`:\\n  - Unique constraint on `org_id, code`\\n  - Composite index on `org_id, category`, index on `active`, index on `import_job_id`\\n- `cost_code_import_jobs`:\\n  - Composite index on `org_id`\\n  - Embedded collection: `cost_code_import_previews` (element collection)\\n\\n#### V8__Create_Communication_Domain_Tables.sql\\n\\n**Tables**: `email_templates`, `contact_inquiries`, `notifications`\\n\\n**Order**: All depend on organizations, create in any order.\\n\\n**Key Features**:\\n\\n- `email_templates`:\\n  - Unique constraint on `org_id, name, locale`\\n  - Embedded collections: `email_template_required_variables`, `email_template_optional_variables` (element collections)\\n- `contact_inquiries`:\\n  - Indexes on `created_at DESC`, `status, created_at DESC`\\n- `notifications`:\\n  - Composite index on `org_id, user_id, read, created_at DESC`\\n\\n#### V9__Create_Legal_Domain_Tables.sql\\n\\n**Tables**: `legal_docs`, `legal_acceptances`\\n\\n**Order**: Create `legal_docs` first (no dependencies), then `legal_acceptances` (depends on users, legal_docs).\\n\\n**Key Features**:\\n\\n- `legal_docs`:\\n  - Unique constraint on `type, version`\\n  - Composite index on `type, effective_at DESC, created_at DESC`\\n- `legal_acceptances`:\\n  - Unique constraint on `user_id, doc_type, version`\\n  - Composite index on `org_id, doc_type, version`\\n\\n#### V10__Create_System_Domain_Tables.sql\\n\\n**Tables**: `event_logs`, `tenant_migrations`\\n\\n**Order**: Both depend on organizations, create in any order.\\n\\n**Key Features**:\\n\\n- `event_logs`:\\n  - Composite indexes on `org_id, created_at DESC`, `org_id, entity_id, created_at DESC`, `org_id, action, created_at DESC`, `org_id, event_type, created_at DESC`\\n  - TTL index on `created_at` (10 years retention, skip when legal_hold is true)\\n- `tenant_migrations`:\\n  - Composite index on `org_id`\\n  - Embedded collection: `tenant_migration_progress` (JSONB or Map structure)\\n\\n### Migration Script Guidelines\\n\\n1. **Table Creation Order**: Respect foreign key dependencies - create referenced tables before referencing tables\\n2. **Enum Handling**: Use VARCHAR columns with CHECK constraints or ENUM types (PostgreSQL supports both)\\n3. **Default Values**: Set defaults for NOT NULL columns with default values\\n4. **Indexes**: Create all indexes defined in Mongoose schemas, including:\\n\\n   - Unique constraints\\n   - Composite indexes\\n   - Partial indexes (using WHERE clauses where possible)\\n\\n5. **Foreign Keys**: Add foreign key constraints with appropriate ON DELETE behavior:\\n\\n   - `ON DELETE RESTRICT` for critical relationships\\n   - `ON DELETE SET NULL` for optional relationships\\n   - `ON DELETE CASCADE` for dependent data\\n\\n6. **Element Collections**: For `@ElementCollection` fields, create separate tables:\\n\\n   - `{entity}_{collection_name}` tables\\n   - Foreign key to parent entity\\n   - Appropriate indexes\\n\\n7. **Embedded Objects**: For complex embedded objects (JSONB), use JSONB columns in PostgreSQL\\n8. **Timestamps**: Use `TIMESTAMP` type, set defaults for `created_at` and `updated_at`\\n9. **Boolean Defaults**: Set `DEFAULT false` for boolean fields with defaults\\n10. **Nullable Fields**: Mark optional fields as `NULL`, required fields as `NOT NULL`\\n\\n### Element Collection Tables\\n\\nCreate separate tables for `@ElementCollection` fields:\\n\\n- `person_emails` (person_id, value, normalized, label, is_primary, verified_at)\\n- `person_phones` (person_id, value, e164, label, is_primary)\\n- `person_certifications` (person_id, name, issued_at, expires_at, document_url, notes)\\n- `contact_certifications` (contact_id, name, issued_at, expires_at, document_url, notes)\\n- `project_cost_code_budgets` (project_id, cost_code_id, budgeted_hours, cost_budget)\\n- `project_seat_assignments` (project_id, seat_id, person_id, role, assigned_at, removed_at)\\n- `seat_history` (seat_id, user_id, project_id, role, assigned_at, removed_at)\\n- `office_tag_keys` (office_id, tag_key)\\n- `company_type_keys` (company_id, type_key)\\n- `company_tag_keys` (company_id, tag_key)\\n- `company_location_tag_keys` (company_location_id, tag_key)\\n- `person_tag_keys` (person_id, tag_key)\\n- `person_skill_keys` (person_id, skill_key)\\n- `person_skill_free_text` (person_id, skill_text)\\n- `contact_roles` (contact_id, role)\\n- `contact_tags` (contact_id, tag)\\n- `contact_skills` (contact_id, skill)\\n- `email_template_required_variables` (email_template_id, variable)\\n- `email_template_optional_variables` (email_template_id, variable)\\n- `estimate_line_items` (estimate_id, code, description, quantity, unit, unit_cost, total)\\n- `cost_code_import_previews` (cost_code_import_job_id, category, code, description)\\n- `org_taxonomy_values` (org_taxonomy_id, key, label, sort_order, color, metadata JSONB, archived_at)\\n\\n### Indexes to Create\\n\\nReplicate all Mongoose indexes:\\n\\n- Unique indexes for business keys\\n- Composite indexes for common query patterns\\n- Partial unique indexes (using WHERE clauses) for soft-delete scenarios\\n- TTL indexes (using application logic or PostgreSQL features)\\n\\n### Foreign Key Constraints\\n\\nDefine foreign keys with appropriate cascade behavior:\\n\\n- `users.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `persons.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `persons.reports_to_person_id` \\u2192 `persons.id` (SET NULL)\\n- `persons.org_location_id` \\u2192 `offices.id` (SET NULL)\\n- `persons.company_id` \\u2192 `companies.id` (SET NULL)\\n- `persons.company_location_id` \\u2192 `company_locations.id` (SET NULL)\\n- `persons.user_id` \\u2192 `users.id` (SET NULL)\\n- `projects.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `projects.office_id` \\u2192 `offices.id` (SET NULL)\\n- `estimates.project_id` \\u2192 `projects.id` (RESTRICT)\\n- `estimates.created_by_user_id` \\u2192 `users.id` (RESTRICT)\\n- `seats.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `seats.user_id` \\u2192 `users.id` (SET NULL)\\n- `seats.project_id` \\u2192 `projects.id` (SET NULL)\\n- `company_locations.company_id` \\u2192 `companies.id` (RESTRICT)\\n- `cost_codes.import_job_id` \\u2192 `cost_code_import_jobs.id` (SET NULL)\\n- `invites.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `invites.person_id` \\u2192 `persons.id` (SET NULL)\\n- `invites.created_by_user_id` \\u2192 `users.id` (RESTRICT)\\n- `invites.invited_user_id` \\u2192 `users.id` (SET NULL)\\n- `legal_acceptances.user_id` \\u2192 `users.id` (RESTRICT)\\n- `legal_acceptances.org_id` \\u2192 `organizations.id` (SET NULL)\\n- `notifications.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `notifications.user_id` \\u2192 `users.id` (RESTRICT)\\n- `email_templates.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `contacts.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `contacts.office_id` \\u2192 `offices.id` (SET NULL)\\n- `contacts.reports_to_contact_id` \\u2192 `contacts.id` (SET NULL)\\n- `contacts.invited_user_id` \\u2192 `users.id` (SET NULL)\\n- `contacts.foreman_user_id` \\u2192 `users.id` (SET NULL)\\n- `offices.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `offices.parent_org_location_id` \\u2192 `offices.id` (SET NULL)\\n- `org_taxonomies.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `graph_edges.org_id` \\u2192 `organizations.id` (RESTRICT)\\n- `event_logs.org_id` \\u2192 `organizations.id` (SET NULL)\\n- `tenant_migrations.org_id` \\u2192 `organizations.id` (RESTRICT)\\n\\n## Repository Layer\\n\\nCreate Spring Data JPA repository interfaces for all entities, organized by domain. Repositories should extend `JpaRepository` and include custom query methods based on NestJS service patterns.\\n\\n### Repository Structure\\n\\n```\\nspring-boot-api/src/main/java/com/mytegroup/api/repository/\\n\\u251c\\u2500\\u2500 core/\\n\\u2502   \\u251c\\u2500\\u2500 UserRepository.java\\n\\u2502   \\u251c\\u2500\\u2500 OrganizationRepository.java\\n\\u2502   \\u251c\\u2500\\u2500 InviteRepository.java\\n\\u2502   \\u2514\\u2500\\u2500 WaitlistEntryRepository.java\\n\\u251c\\u2500\\u2500 people/\\n\\u2502   \\u251c\\u2500\\u2500 PersonRepository.java\\n\\u2502   \\u2514\\u2500\\u2500 ContactRepository.java\\n\\u251c\\u2500\\u2500 organization/\\n\\u2502   \\u251c\\u2500\\u2500 OfficeRepository.java\\n\\u2502   \\u251c\\u2500\\u2500 OrgTaxonomyRepository.java\\n\\u2502   \\u2514\\u2500\\u2500 GraphEdgeRepository.java\\n\\u251c\\u2500\\u2500 projects/\\n\\u2502   \\u251c\\u2500\\u2500 ProjectRepository.java\\n\\u2502   \\u251c\\u2500\\u2500 EstimateRepository.java\\n\\u2502   \\u2514\\u2500\\u2500 SeatRepository.java\\n\\u251c\\u2500\\u2500 companies/\\n\\u2502   \\u251c\\u2500\\u2500 CompanyRepository.java\\n\\u2502   \\u2514\\u2500\\u2500 CompanyLocationRepository.java\\n\\u251c\\u2500\\u2500 cost/\\n\\u2502   \\u251c\\u2500\\u2500 CostCodeRepository.java\\n\\u2502   \\u2514\\u2500\\u2500 CostCodeImportJobRepository.java\\n\\u251c\\u2500\\u2500 communication/\\n\\u2502   \\u251c\\u2500\\u2500 EmailTemplateRepository.java\\n\\u2502   \\u251c\\u2500\\u2500 ContactInquiryRepository.java\\n\\u2502   \\u2514\\u2500\\u2500 NotificationRepository.java\\n\\u251c\\u2500\\u2500 legal/\\n\\u2502   \\u251c\\u2500\\u2500 LegalDocRepository.java\\n\\u2502   \\u2514\\u2500\\u2500 LegalAcceptanceRepository.java\\n\\u2514\\u2500\\u2500 system/\\n    \\u251c\\u2500\\u2500 EventLogRepository.java\\n    \\u2514\\u2500\\u2500 TenantMigrationRepository.java\\n```\\n\\n### Common Repository Patterns\\n\\n#### Base Repository Methods\\n\\nAll repositories should include:\\n\\n1. **Soft Delete Support**:\\n\\n   - `findByOrgIdAndArchivedAtIsNull(Long orgId)` - Find active entities\\n   - `findByOrgId(Long orgId)` - Find all (including archived)\\n   - `existsByOrgIdAndArchivedAtIsNull(Long orgId)` - Check if active exists\\n\\n2. **Organization Scoping**:\\n\\n   - All queries should be scoped by `orgId` for multi-tenant isolation\\n   - Use `@Query` annotations for complex queries\\n\\n3. **Pagination Support**:\\n\\n   - Use `Pageable` parameter for pagination\\n   - Return `Page<T>` or custom pagination DTOs\\n\\n### Domain-Specific Repository Methods\\n\\n#### Core Domain Repositories\\n\\n**UserRepository**:\\n\\n- `findByEmail(String email)` - Find by email (unique)\\n- `findByOrgIdAndArchivedAtIsNull(Long orgId)` - List active users\\n- `findByOrgIdAndEmail(Long orgId, String email)` - Find by org and email\\n- `existsByEmail(String email)` - Check email exists\\n- `findByOrgIdAndRolesContaining(Long orgId, String role)` - Find by role\\n\\n**OrganizationRepository**:\\n\\n- `findByName(String name)` - Find by name (unique)\\n- `findByPrimaryDomain(String domain)` - Find by primary domain\\n- `findByDatastoreType(DatastoreType type)` - Find by datastore type\\n- `existsByArchivedAtIsNull()` - Check if any active org exists\\n\\n**InviteRepository**:\\n\\n- `findByOrgIdAndEmailAndStatus(Long orgId, String email, InviteStatus status)`\\n- `findByOrgIdAndPersonIdAndStatus(Long orgId, Long personId, InviteStatus status)`\\n- `findByTokenHash(String tokenHash)`\\n- `findByTokenExpiresBefore(LocalDateTime date)` - Find expired invites\\n\\n**WaitlistEntryRepository**:\\n\\n- `findByEmail(String email)` - Find by email (unique)\\n- `findByStatusAndCreatedAtDesc(WaitlistStatus status, Pageable pageable)`\\n- `findByVerifyStatusAndStatusAndCreatedAtAsc(WaitlistVerifyStatus verifyStatus, WaitlistStatus status, Pageable pageable)`\\n- `findByEmailContainingIgnoreCase(String email)` - Search by email\\n\\n#### People Domain Repositories\\n\\n**PersonRepository**:\\n\\n- `findByOrgIdAndArchivedAtIsNull(Long orgId, Pageable pageable)` - List with pagination\\n- `findByOrgIdAndPersonType(Long orgId, PersonType personType)` - Filter by type\\n- `findByOrgIdAndPrimaryEmail(Long orgId, String email)` - Find by primary email\\n- `findByOrgIdAndPrimaryPhoneE164(Long orgId, String phone)` - Find by phone\\n- `findByOrgIdAndIronworkerNumber(Long orgId, String number)` - Find by ironworker number\\n- `findByOrgIdAndCompanyId(Long orgId, Long companyId)` - Find by company\\n- `findByOrgIdAndCompanyLocationId(Long orgId, Long locationId)` - Find by location\\n- `findByOrgIdAndOrgLocationId(Long orgId, Long officeId)` - Find by office\\n- `findByOrgIdAndReportsToPersonId(Long orgId, Long managerId)` - Find direct reports\\n- `findByOrgIdAndDisplayNameContainingIgnoreCase(Long orgId, String search)` - Search by name\\n- `@Query` methods for complex searches (email, phone, name combinations)\\n- `findByOrgIdAndTagKeysContaining(Long orgId, String tagKey)` - Find by tag\\n- `findByOrgIdAndSkillKeysContaining(Long orgId, String skillKey)` - Find by skill\\n\\n**ContactRepository**:\\n\\n- `findByOrgIdAndArchivedAtIsNull(Long orgId, Pageable pageable)`\\n- `findByOrgIdAndPersonTypeAndArchivedAtIsNull(Long orgId, ContactPersonType personType)`\\n- `findByOrgIdAndEmail(Long orgId, String email)`\\n- `findByOrgIdAndIronworkerNumber(Long orgId, String number)`\\n- `findByOrgIdAndOfficeId(Long orgId, Long officeId)`\\n- `findByOrgIdAndReportsToContactId(Long orgId, Long managerId)` - Find direct reports\\n\\n#### Organization Domain Repositories\\n\\n**OfficeRepository**:\\n\\n- `findByOrgIdAndArchivedAtIsNull(Long orgId)` - List active offices\\n- `findByOrgIdAndNormalizedName(Long orgId, String normalizedName)` - Find by normalized name\\n- `findByOrgIdAndParentOrgLocationId(Long orgId, Long parentId)` - Find children\\n- `findByOrgIdAndParentOrgLocationIdIsNull(Long orgId)` - Find root offices\\n- `findByOrgIdAndTagKeysContaining(Long orgId, String tagKey)` - Find by tag\\n\\n**OrgTaxonomyRepository**:\\n\\n- `findByOrgIdAndNamespace(Long orgId, String namespace)` - Find by namespace\\n- `findByOrgId(Long orgId)` - Find all taxonomies for org\\n\\n**GraphEdgeRepository**:\\n\\n- `findByOrgIdAndFromNodeTypeAndFromNodeId(Long orgId, GraphNodeType nodeType, Long nodeId)`\\n- `findByOrgIdAndToNodeTypeAndToNodeId(Long orgId, GraphNodeType nodeType, Long nodeId)`\\n- `findByOrgIdAndEdgeTypeKey(Long orgId, String edgeTypeKey)`\\n- `findByOrgIdAndArchivedAtIsNull(Long orgId)` - List active edges\\n\\n#### Projects Domain Repositories\\n\\n**ProjectRepository**:\\n\\n- `findByOrgIdAndArchivedAtIsNull(Long orgId, Pageable pageable)`\\n- `findByOrgIdAndName(Long orgId, String name)` - Find by name (unique when not archived)\\n- `findByOrgIdAndProjectCode(Long orgId, String projectCode)` - Find by code (unique when not archived)\\n- `findByOrgIdAndOfficeId(Long orgId, Long officeId)` - Find by office\\n- `findByOrgIdAndNameContainingIgnoreCase(Long orgId, String search)` - Search by name\\n\\n**EstimateRepository**:\\n\\n- `findByOrgIdAndProjectIdAndArchivedAtIsNull(Long orgId, Long projectId)`\\n- `findByOrgIdAndProjectIdAndName(Long orgId, Long projectId, String name)` - Find by name (unique when not archived)\\n- `findByProjectId(Long projectId)` - Find all estimates for project\\n- `findByCreatedByUserId(Long userId)` - Find by creator\\n\\n**SeatRepository**:\\n\\n- `findByOrgIdAndSeatNumber(Long orgId, Integer seatNumber)` - Find by seat number (unique)\\n- `findByOrgIdAndStatus(Long orgId, SeatStatus status)` - Find by status\\n- `findByOrgIdAndRoleAndStatus(Long orgId, String role, SeatStatus status)`\\n- `findByOrgIdAndProjectId(Long orgId, Long projectId)` - Find by project\\n- `findByOrgIdAndUserId(Long orgId, Long userId)` - Find by user (unique when not null)\\n- `findByOrgIdAndStatusOrderBySeatNumber(Long orgId, SeatStatus status)` - List ordered\\n\\n#### Companies Domain Repositories\\n\\n**CompanyRepository**:\\n\\n- `findByOrgIdAndArchivedAtIsNull(Long orgId, Pageable pageable)`\\n- `findByOrgIdAndNormalizedName(Long orgId, String normalizedName)` - Find by name (unique when not archived)\\n- `findByOrgIdAndExternalId(Long orgId, String externalId)` - Find by external ID (unique when not archived)\\n- `findByOrgIdAndNameContainingIgnoreCase(Long orgId, String search)` - Search by name\\n- `findByOrgIdAndCompanyTypeKeysContaining(Long orgId, String typeKey)` - Find by type\\n- `findByOrgIdAndTagKeysContaining(Long orgId, String tagKey)` - Find by tag\\n\\n**CompanyLocationRepository**:\\n\\n- `findByOrgIdAndCompanyIdAndArchivedAtIsNull(Long orgId, Long companyId)`\\n- `findByOrgIdAndCompanyIdAndNormalizedName(Long orgId, Long companyId, String normalizedName)` - Find by name (unique when not archived)\\n- `findByOrgIdAndCompanyIdAndExternalId(Long orgId, Long companyId, String externalId)` - Find by external ID\\n- `findByCompanyId(Long companyId)` - Find all locations for company\\n- `findByOrgIdAndTagKeysContaining(Long orgId, String tagKey)` - Find by tag\\n\\n#### Cost Domain Repositories\\n\\n**CostCodeRepository**:\\n\\n- `findByOrgIdAndCode(Long orgId, String code)` - Find by code (unique)\\n- `findByOrgIdAndCategory(Long orgId, String category)` - Find by category\\n- `findByOrgIdAndActive(Long orgId, Boolean active)` - Find by active status\\n- `findByOrgIdAndIsUsed(Long orgId, Boolean isUsed)` - Find by usage\\n- `findByImportJobId(Long importJobId)` - Find by import job\\n\\n**CostCodeImportJobRepository**:\\n\\n- `findByOrgId(Long orgId)` - Find all jobs for org\\n- `findByOrgIdAndStatus(Long orgId, CostCodeImportStatus status)` - Find by status\\n\\n#### Communication Domain Repositories\\n\\n**EmailTemplateRepository**:\\n\\n- `findByOrgIdAndNameAndLocale(Long orgId, String name, String locale)` - Find by name and locale (unique)\\n- `findByOrgIdAndName(Long orgId, String name)` - Find all locales for template\\n\\n**ContactInquiryRepository**:\\n\\n- `findByStatusOrderByCreatedAtDesc(ContactInquiryStatus status, Pageable pageable)`\\n- `findAllByOrderByCreatedAtDesc(Pageable pageable)` - List all ordered\\n\\n**NotificationRepository**:\\n\\n- `findByOrgIdAndUserIdAndReadOrderByCreatedAtDesc(Long orgId, Long userId, Boolean read, Pageable pageable)`\\n- `findByOrgIdAndUserIdOrderByCreatedAtDesc(Long orgId, Long userId, Pageable pageable)` - All for user\\n- `countByOrgIdAndUserIdAndReadFalse(Long orgId, Long userId)` - Count unread\\n\\n#### Legal Domain Repositories\\n\\n**LegalDocRepository**:\\n\\n- `findByTypeAndVersion(LegalDocType type, String version)` - Find by type and version (unique)\\n- `findByTypeOrderByEffectiveAtDescCreatedAtDesc(LegalDocType type)` - Find latest by type\\n\\n**LegalAcceptanceRepository**:\\n\\n- `findByUserIdAndDocTypeAndVersion(Long userId, LegalDocType docType, String version)` - Find acceptance (unique)\\n- `findByUserIdAndDocType(Long userId, LegalDocType docType)` - Find all acceptances for doc type\\n- `findByOrgIdAndDocTypeAndVersion(Long orgId, LegalDocType docType, String version)` - Find by org\\n\\n#### System Domain Repositories\\n\\n**EventLogRepository**:\\n\\n- `findByOrgIdOrderByCreatedAtDesc(Long orgId, Pageable pageable)` - List events\\n- `findByOrgIdAndEntityIdOrderByCreatedAtDesc(Long orgId, String entityId, Pageable pageable)` - Find by entity\\n- `findByOrgIdAndActionOrderByCreatedAtDesc(Long orgId, String action, Pageable pageable)` - Find by action\\n- `findByOrgIdAndEventTypeOrderByCreatedAtDesc(Long orgId, String eventType, Pageable pageable)` - Find by event type\\n- `findByOrgIdAndEntityTypeAndEntityIdOrderByCreatedAtDesc(Long orgId, String entityType, String entityId, Pageable pageable)`\\n- `findByCreatedAtBetween(LocalDateTime start, LocalDateTime end)` - Find by date range\\n\\n**TenantMigrationRepository**:\\n\\n- `findByOrgId(Long orgId)` - Find migrations for org\\n- `findByOrgIdAndStatus(Long orgId, MigrationStatus status)` - Find by status\\n- `findByStatus(MigrationStatus status)` - Find all by status (admin)\\n\\n### Custom Query Methods\\n\\nFor complex queries that can't be expressed with method names, use `@Query` annotations:\\n\\n```java\\n@Query(\\\"SELECT p FROM Person p WHERE p.orgId = :orgId AND \\\" +\\n       \\\"(LOWER(p.displayName) LIKE LOWER(CONCAT('%', :search, '%')) OR \\\" +\\n       \\\"LOWER(p.primaryEmail) LIKE LOWER(CONCAT('%', :search, '%')))\\\")\\nList<Person> searchPersons(@Param(\\\"orgId\\\") Long orgId, @Param(\\\"search\\\") String search);\\n```\\n\\n### Element Collection Queries\\n\\nFor `@ElementCollection` fields, create separate repository methods or use joins:\\n\\n```java\\n@Query(\\\"SELECT p FROM Person p JOIN p.emails e WHERE p.orgId = :orgId AND e.normalized = :email\\\")\\nOptional<Person> findByOrgIdAndEmailNormalized(@Param(\\\"orgId\\\") Long orgId, @Param(\\\"email\\\") String email);\\n```\\n\\n### Repository Implementation Notes\\n\\n1. **Soft Delete Pattern**: Always filter by `archivedAt IS NULL` unless explicitly including archived\\n2. **Organization Scoping**: All queries should include `orgId` parameter for multi-tenant isolation\\n3. **Pagination**: Use `Pageable` and return `Page<T>` for consistent pagination\\n4. **Unique Constraints**: Use `Optional<T>` return type for unique lookups\\n5. **Indexes**: Leverage database indexes defined in Flyway migrations for performance\\n6. **Custom Queries**: Use `@Query` with JPQL or native SQL for complex searches\\n7. **Specifications**: Consider using JPA Specifications for dynamic query building\\n8. **Projections**: Use DTO projections for read-only queries to improve performance\\n\\n## Next Steps\\n\\n1. Create domain package structure\\n2. Create embeddable classes for complex nested objects\\n3. Create enum classes for all TypeScript enums (organized by domain)\\n4. Create entity classes with proper JPA annotations\\n5. Add relationship mappings (@ManyToOne, @OneToMany)\\n6. Add indexes and constraints\\n7. Create Flyway migration scripts (V2-V10) for all tables, element collections, indexes, and foreign keys\\n8. Create Spring Data JPA repository interfaces for all entities with common and domain-specific query methods\\n\\n\",\n  \"additional_context\": []\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://api.myte.dev/api/project-assistant/query",
          "protocol": "https",
          "host": [
            "api",
            "myte",
            "dev"
          ],
          "path": [
            "api",
            "project-assistant",
            "query"
          ]
        }
      },
      "response": []
    }
  ]
}