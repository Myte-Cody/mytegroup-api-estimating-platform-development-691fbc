spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:mytegroup_test}
    username: ${DB_USER:postgres}
    password: ${DB_PASSWORD:postgres}
    # Connection pool settings for testing
    hikari:
      maximum-pool-size: 5
      minimum-idle: 2
      connection-timeout: 10000
  
  autoconfigure:
    exclude:
      # Exclude Redis data auto-config which causes redisKeyValueAdapter issues in tests
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration
  
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        use_sql_comments: false
        jdbc:
          batch_size: 10
          fetch_size: 50
  
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: false
    out-of-order: false
  
  mail:
    host: ${SMTP_HOST:localhost}
    port: ${SMTP_PORT:1025}
    username: ${SMTP_USER:}
    password: ${SMTP_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: false
          starttls:
            enable: false
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000
  
  thymeleaf:
    cache: false

  # Disable unnecessary services in test
  mvc:
    log-request-details: false
    throw-exception-if-no-handler-found: true
  web:
    resources:
      add-mappings: false
  
  # Redis configuration for tests
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    timeout: 2000ms
    jedis:
      pool:
        max-active: 10
        max-idle: 5
        min-idle: 0

logging:
  level:
    root: WARN
    com.mytegroup: INFO
    org.springframework: WARN
    org.hibernate: WARN
    org.testcontainers: WARN

management:
  endpoint:
    health:
      show-details: never
  endpoints:
    web:
      exposure:
        include: health

# Test-specific configuration
test:
  database:
    initialization-mode: always

# Disable waitlist gates for tests
app:
  waitlist:
    invite-gate-enabled: false  # Disable invite gate to allow registration without waitlist
    domain-gate-enabled: false  # Disable domain gate to allow any domain
    require-invite-token: false  # Don't require invite tokens

